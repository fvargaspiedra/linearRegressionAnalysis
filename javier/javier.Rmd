---
title: "Scratch pad for Colinearity Analysis"
author: "Javier Matias-Cabrera, javierm4"
date: ''
output:
  html_document:
    toc: yes
  pdf_document: default
urlcolor: cyan
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(digits=8)

```

```{r message=FALSE, warning=FALSE}
#options(repos=c(CRAN="<something sensible near you>"))
#install.packages(c("jtools","emmeans"))
library(lmtest)
library(jtools)
library(emmeans)
library(car)

source("load_dataset.r")
source("transformations.r")
source("plots.r")

```


## Introduction

For this study, we will perform some exploratory data analysis to explain how the effect of different predictors on the `Sale Price` of a home varies across different `Neighborhoods`. We will attempt to infer which Neighborhoods place the highest monetary value on Living Area and determine whether the `Neighborhood` is collinear with other predictors.

## Methods

We will begin by loading the housing data stored in `AmesHousing.csv`. We will also define a convenience function `splitDataset` that will randomly split the data into two data sets: *"train"* and *"test"*.
```{r message=FALSE, warning=FALSE}

splitDataset = function(data) {
  training = createDataPartition(data$SalePrice, times=1, p=0.80, list=FALSE)
  return(list(train=data[training,], test=data[-training,]))
}

housing_data = read_dataset("../data/AmesHousing.csv")

splits = splitDataset(housing_data)
training_data = splits$train
test_data = splits$test
```

Now we can begin our exploratory data analysis. To examine the relationship between `Neighborhood` and `SalePrice`, we'll perform a simple one-way ANOVA to determine whether it has any effect on `SalePrice` at all.

```{r}
neighborhood_oneway_anova = aov(SalePrice ~ Neighborhood, data=housing_data)
summary(neighborhood_oneway_anova)
```






I would like to know if the living area of a house is more valuable in some neighborhoods than others. We'll do an ANOVA for the interaction between these two predictors.
```{r}
housing_data$base = ifelse(housing_data$BsmtFin.SF.1 > 0,"Yes","No") 
table(housing_data$base)

model = lm(SalePrice ~  Gr.Liv.Area*Neighborhood, data=housing_data)
summary = anova(model)
summary(model)


#car::vif(lm(SalePrice ~  ., data=housing_data))
#rownames(alias(lm(SalePrice ~  ., data=housing_data))$Complete)
```

P-value of the interaction between Neighborhood and Living Area appears is very small (`r  summary[3,5]`), meaning that different Neighborhoods appear to place a higher value on living space.

We'll plot the slopes of the 6 neighborhoods with the largest amount of observations.
```{r}
ordered_neigh = order(-table(housing_data$Neighborhood))
interact_plot(model, pred=Gr.Liv.Area, modx=Neighborhood, color.class="Qual1",
              modxvals = names(table(housing_data$Neighborhood)[ordered_neigh][1:6]))

```

We notice that the slops are different depending on the neighborhood. We'll do slope analysis to see which of the Gr.Liv.Area slopes are significant.
```{r}
(slopes = sim_slopes(model, pred=Gr.Liv.Area, modx=Neighborhood, johnson_neyman = FALSE,
                     centered= "none", confint=T))
```


## Analysis

## Discussion

